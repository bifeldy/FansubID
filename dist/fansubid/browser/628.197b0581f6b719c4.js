"use strict";(self.webpackChunkfansubid=self.webpackChunkfansubid||[]).push([[628],{7628:(B,m,o)=>{o.r(m),o.d(m,{VerifyModule:()=>J});var p=o(9808),c=o(8406),r=o(3075),h=o(3290),v=o(210),y=o(5861),b=o(4249),g=o(5934),u=o(6271),e=o(5e3),k=o(8058),U=o(3e3),I=o(7845),_=o(8696),V=o(4137),x=o(8020),d=o(5615),C=o(7423),T=o(5245);const K=["stepper"];function R(a,l){1&a&&e._uU(0,"Cari Tanda Pengenal")}function Z(a,l){1&a&&(e.TgZ(0,"strong"),e._uU(1," Nomor NIK Tidak Boleh Kosong! "),e._UZ(2,"br"),e.qZA())}function D(a,l){1&a&&(e.TgZ(0,"strong"),e._uU(1," Nomor NIK Hanya Boleh Angka "),e._UZ(2,"br"),e.qZA())}function N(a,l){1&a&&(e.TgZ(0,"strong"),e._uU(1," Nama Depan Tidak Boleh Kosong! "),e._UZ(2,"br"),e.qZA())}function E(a,l){1&a&&(e.TgZ(0,"strong"),e._uU(1," Nama Depan Hanya Boleh Huruf "),e._UZ(2,"br"),e.qZA())}function A(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"form",17)(1,"div",18)(2,"label",19),e._uU(3,"NIK KTP"),e.qZA(),e.TgZ(4,"div",20),e._UZ(5,"input",21),e.TgZ(6,"span",22),e.YNc(7,Z,3,0,"strong",23),e.YNc(8,D,3,0,"strong",23),e.qZA()()(),e.TgZ(9,"div",18)(10,"label",24),e._uU(11,"Nama Depan"),e.qZA(),e.TgZ(12,"div",20),e._UZ(13,"input",25),e.TgZ(14,"span",22),e.YNc(15,N,3,0,"strong",23),e.YNc(16,E,3,0,"strong",23),e.qZA()()(),e.TgZ(17,"div",26)(18,"div",27)(19,"re-captcha",28,29),e.NdJ("resolved",function(i){e.CHM(t);const n=e.MAs(20);return e.oxw().captcha(i,n)}),e.qZA()()(),e.TgZ(21,"div",26)(22,"div",30)(23,"div",31)(24,"div",32)(25,"button",33),e.NdJ("click",function(){return e.CHM(t),e.oxw().findNik()}),e._uU(26," Cari KTP "),e.TgZ(27,"mat-icon",34),e._uU(28,"search"),e.qZA()()()()()()()}if(2&a){const t=e.oxw();e.Q6J("formGroup",t.fg1),e.xp6(5),e.Gre("form-control ",!t.fg1.get("nik").valid&&t.fg1.get("nik").touched?"is-invalid":"",""),e.xp6(2),e.Q6J("ngIf",t.fg1.get("nik").hasError("required")),e.xp6(1),e.Q6J("ngIf",t.fg1.get("nik").hasError("pattern")),e.xp6(5),e.Gre("form-control ",!t.fg1.get("nama").valid&&t.fg1.get("nama").touched?"is-invalid":"",""),e.xp6(2),e.Q6J("ngIf",t.fg1.get("nama").hasError("required")),e.xp6(1),e.Q6J("ngIf",t.fg1.get("nama").hasError("pattern")),e.xp6(3),e.Q6J("siteKey",t.G_CAPTCHA_SITE_KEY),e.xp6(6),e.Q6J("disabled",t.submitted||t.fg1.invalid)}}function S(a,l){1&a&&e._uU(0,"Periksa Data Identitas")}function O(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"form",17)(1,"div",26)(2,"div",32)(3,"button",33),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(),n=e.MAs(15);return i.submitKTP(n)}),e._uU(4," Data Saya Diatas Sudah Benar "),e.TgZ(5,"mat-icon",34),e._uU(6,"check_circle_outline"),e.qZA()()()()()}if(2&a){const t=e.oxw();e.Q6J("formGroup",t.fg2),e.xp6(3),e.Q6J("disabled",t.submitted)}}const Y=function(a){return{"background-position":"center","background-size":"cover","background-image":a}},G=[{path:"",pathMatch:"full",component:(()=>{class a{constructor(t,s,i,n,f,P,$,M,Q){this.fb=t,this.router=s,this.us=i,this.bs=n,this.ds=f,this.gs=P,this.activatedRoute=$,this.as=M,this.wb=Q,this.captchaRef=null,this.submitted=!1,this.returnUrl="/",this.verifyImg="/assets/img/verify.png",this.verifyInfo="Verifikasi akunmu dan dapatkan fitur menarik lainnya~",this.kpuRiUserData=null,this.subsCekNik=null,this.subsVerify1=null,this.subsVerify2=null,this.subsSosmed=null,this.subsDialog=null,this.gs.bannerImg=null,this.gs.sizeContain=!1,this.gs.bgRepeat=!1}get ENV(){return g.N}ngOnDestroy(){var t,s,i,n,f;null===(t=this.subsCekNik)||void 0===t||t.unsubscribe(),null===(s=this.subsVerify1)||void 0===s||s.unsubscribe(),null===(i=this.subsVerify2)||void 0===i||i.unsubscribe(),null===(n=this.subsSosmed)||void 0===n||n.unsubscribe(),null===(f=this.subsDialog)||void 0===f||f.unsubscribe()}ngOnInit(){var t,s;if(this.returnUrl=this.activatedRoute.snapshot.queryParamMap.get("returnUrl")||"/",this.returnUrl.includes("/login")&&(this.returnUrl="/"),this.gs.isBrowser){this.initKTP();const i=this.activatedRoute.snapshot.queryParamMap.get("app"),n=this.activatedRoute.snapshot.queryParamMap.get("code")||"";i&&n?this.sosmedVerify(i,n):(null===(s=null===(t=this.as.currentUserSubject)||void 0===t?void 0:t.value)||void 0===s?void 0:s.verified)?this.router.navigateByUrl(this.returnUrl):this.verifyByKtpDisabled()}}get G_CAPTCHA_SITE_KEY(){return u.t.gCaptchaSiteKey}sosmedVerify(t,s){this.bs.busy(),this.subsSosmed=this.us.sosmedLogin({app:t.toUpperCase(),code:s}).subscribe({next:i=>{this.gs.log("[SOSMED]",i),this.bs.idle(),this.sosmedVerifyResult(i,t)},error:i=>{this.gs.log("[SOSMED]",i,"error"),this.bs.idle(),this.sosmedVerifyResult(i,t)}})}sosmedVerifyResult(t,s){var i;this.subsDialog=this.ds.openInfoDialog({data:{title:(null===(i=t.result)||void 0===i?void 0:i.title)||"Whoops, Terjadi Kesalahan!",htmlMessage:t.result.message,confirmText:"Tutup",cancelText:"Ulangi"}}).afterClosed().subscribe({next:n=>{if(this.gs.log("[INFO_DIALOG_CLOSED]",n),!0===n)this.as.removeUser(),this.router.navigate(["/login"],{queryParams:{returnUrl:this.returnUrl}});else if(!1===n){const f=s.toUpperCase();f===b.Bp.DISCORD?this.openVerifyDiscordUrl():f===b.Bp.GOOGLE&&this.openVerifyGoogleUrl()}this.subsDialog.unsubscribe()}})}verifyByKtpDisabled(){var t=this;return(0,y.Z)(function*(){t.subsDialog=(yield t.ds.openVerifikasiSosmed()).afterClosed().subscribe({next:s=>{t.gs.log("[INFO_DIALOG_CLOSED]",s),!0===s?t.openVerifyDiscordUrl():!1===s?t.openVerifyGoogleUrl():t.router.navigateByUrl(t.returnUrl),t.subsDialog.unsubscribe()}})})()}openVerifyDiscordUrl(){this.wb.winboxOpenUri(`${g.N.baseUrl}/api/discord-verifikasi`,"_self")}openVerifyGoogleUrl(){this.wb.winboxOpenUri(`${g.N.baseUrl}/api/google-verifikasi`,"_self")}initKTP(){this.fg1=this.fb.group({nik:[null,[r.kI.required,r.kI.pattern(/^\d+$/)]],nama:[null,[r.kI.required,r.kI.pattern("^[a-zA-Z. ]+$")]],completed:[null,[r.kI.required]],"g-recaptcha-response":[null,[r.kI.required,r.kI.pattern(u.t.regexEnglishKeyboardKeys)]]}),this.fg2=this.fb.group({nik:[null,[r.kI.pattern(/^\d+$/)]],nama:[null,[r.kI.pattern("^[a-zA-Z. ]+$")]],tempat_lahir:[null,[r.kI.pattern("^[a-zA-Z ]+$")]],tanggal_lahir:[null,[r.kI.pattern(u.t.regexEnglishKeyboardKeys)]],jenis_kelamin:[null,[r.kI.pattern("^[LP]+$")]],golongan_darah:[null,[r.kI.pattern("^[ABO]+$")]],alamat:[null,[r.kI.pattern(u.t.regexEnglishKeyboardKeys)]],rt:[null,[r.kI.pattern(/^\d+$/)]],rw:[null,[r.kI.pattern(/^\d+$/)]],kelurahan_desa:[null,[r.kI.pattern(u.t.regexEnglishKeyboardKeys)]],kecamatan:[null,[r.kI.pattern(u.t.regexEnglishKeyboardKeys)]],agama:[null,[r.kI.pattern(u.t.regexEnglishKeyboardKeys)]],status_perkawinan:[null,[r.kI.pattern(u.t.regexEnglishKeyboardKeys)]],pekerjaan:[null,[r.kI.pattern(u.t.regexEnglishKeyboardKeys)]],kewarganegaraan:[null,[r.kI.pattern("^[WNIA]+$")]]})}captcha(t,s){this.gs.log(`[GOOGLE_CAPTCHA] ${t}`),t?(this.captchaRef=s,this.fg1.controls["g-recaptcha-response"].patchValue(t)):this.fg1.value["g-recaptcha-response"]&&this.fg1.controls["g-recaptcha-response"].patchValue(null)}findNik(){this.bs.busy(),this.submitted=!0,this.subsCekNik=this.us.cekNik({nik:this.fg1.value.nik,nama:this.fg1.value.nama,"g-recaptcha-response":this.fg1.value["g-recaptcha-response"]}).subscribe({next:t=>{this.gs.log("[KPU_RI_CEK_NIK]",t),this.bs.idle(),this.submitted=!1,"success"===t.result.message?(this.kpuRiUserData={...t.result.data,nik:this.fg1.value.nik},this.verifyInfo=`\n            ${this.kpuRiUserData.nama} - ${this.kpuRiUserData.jenis_kelamin} - ${this.kpuRiUserData.tempat_lahir} -\n            ${this.kpuRiUserData.nik} - ${this.kpuRiUserData.namaKel} - ${this.kpuRiUserData.namaKec} -\n            ${this.kpuRiUserData.namaKabko} - ${this.kpuRiUserData.namaPropinsi}\n          `.replace(/\n/g," ").replace(/ +(?= )/g,"").trim(),this.fg2.controls.nik.patchValue(this.kpuRiUserData.nik),this.fg2.controls.nama.patchValue(this.kpuRiUserData.nama),this.fg2.controls.jenis_kelamin.patchValue(this.kpuRiUserData.jenis_kelamin),this.fg2.controls.tempat_lahir.patchValue(this.kpuRiUserData.tempat_lahir),this.fg2.controls.kelurahan_desa.patchValue(this.kpuRiUserData.namaKel),this.fg2.controls.kecamatan.patchValue(this.kpuRiUserData.namaKec),this.fg1.controls.completed.patchValue(!0),this.stepper.next(),this.captchaRef.reset()):(this.verifyInfo=t.result.data.pesan,this.fg1.controls["g-recaptcha-response"].patchValue(null),this.fg1.controls.completed.patchValue(null),this.kpuRiUserData=null,this.captchaRef.reset())},error:t=>{var s;this.gs.log("[KPU_RI_CEK_NIK_ERROR]",t),this.bs.idle(),this.submitted=!1,this.verifyInfo=(null===(s=t.result)||void 0===s?void 0:s.message)||t.info,this.captchaRef.reset()}})}submitKTP(t){this.bs.busy(),this.submitted=!0;const s=this.fg2.value;for(const i in s)null==s[i]&&delete s[i];this.subsVerify1=this.us.verifyKTP({...s}).subscribe({next:i=>{this.gs.log("[USER_VERIFIKASI_SUCCESS]",i),this.bs.idle(),this.submitted=!1,this.as.removeUser(),this.bs.busy(),this.subsVerify2=this.as.verify(this.as.token).subscribe({next:n=>{this.gs.log("[VERIFY_LOGIN_SUCCESS]",n),this.bs.idle(),this.router.navigateByUrl(this.returnUrl)},error:n=>{this.gs.log("[VERIFY_LOGIN_ERROR]",n,"error"),this.bs.idle(),this.as.removeUser(),this.router.navigateByUrl(this.returnUrl)}})},error:i=>{var n;this.gs.log("[USER_VERIFIKASI_ERROR]",i,"error"),this.bs.idle(),this.submitted=!1,this.verifyInfo=(null===(n=i.result)||void 0===n?void 0:n.message)||i.info,t.reset()}})}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(r.qu),e.Y36(c.F0),e.Y36(k.K),e.Y36(U.z),e.Y36(I.x),e.Y36(_.U),e.Y36(c.gz),e.Y36(V.e),e.Y36(x.N))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-verify"]],viewQuery:function(t,s){if(1&t&&e.Gf(K,7),2&t){let i;e.iGM(i=e.CRH())&&(s.stepper=i.first)}},decls:22,vars:11,consts:[[1,"container-fluid","align-items-center","w-100","h-100"],[1,"row","align-items-center","h-100","m-0"],[1,"col-12","col-md-10","m-auto","py-3"],[1,"row","rgb-border","rounded","bg-bifeldy"],[1,"col-lg-5","col-md-3","ms-auto","p-0",3,"ngStyle"],[1,"col-lg-7","col-md-9","me-auto","p-0"],[1,"card","bg-transparent","border-0"],[1,"card-body","p-0"],[1,"text-center","p-3"],[1,"mb-4",2,"max-width","128px",3,"src"],[1,"h3","mb-3","font-weight-normal"],[1,"text-warning"],["linear","",2,"background-color","transparent"],["stepper",""],[3,"stepControl","editable"],["matStepLabel",""],["class","m-2",3,"formGroup",4,"ngIf"],[1,"m-2",3,"formGroup"],[1,"form-group","row","py-2"],["for","nik",1,"col-md-4","col-form-label","text-md-end"],[1,"col-md-8"],["type","text","id","nik","placeholder","Nomor Induk Kependudukan","required","","formControlName","nik","autocomplete","nik"],["role","alert",1,"invalid-feedback"],[4,"ngIf"],["for","nama",1,"col-md-4","col-form-label","text-md-end"],["type","text","id","nama","placeholder","Nama Depan","required","","formControlName","nama","autocomplete","nama"],[1,"form-group","row","mb-0","py-2"],[1,"col","offset-md-4"],["formControlName","g-recaptcha-response",3,"siteKey","resolved"],["captchaRef",""],[1,"col-md-8","offset-md-4"],[1,"row"],[1,"col-12"],["mat-flat-button","","color","primary","type","button",1,"w-100",3,"disabled","click"],[1,"ms-1"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e._UZ(4,"div",4),e.TgZ(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8),e._UZ(9,"img",9),e.TgZ(10,"h1",10),e._uU(11,'Yuhu~, Ayo Verifikasi! >_<"'),e.qZA(),e.TgZ(12,"p",11),e._uU(13),e.qZA()(),e.TgZ(14,"mat-vertical-stepper",12,13)(16,"mat-step",14),e.YNc(17,R,1,0,"ng-template",15),e.YNc(18,A,29,13,"form",16),e.qZA(),e.TgZ(19,"mat-step",14),e.YNc(20,S,1,0,"ng-template",15),e.YNc(21,O,7,2,"form",16),e.qZA()()()()()()()()()),2&t&&(e.xp6(4),e.Q6J("ngStyle",e.VKq(9,Y,"url("+s.verifyImg+")")),e.xp6(5),e.MGl("src","",s.ENV.baseUrl,"/assets/img/logo/verify.png",e.LSH),e.xp6(4),e.Oqu(s.verifyInfo),e.xp6(3),e.Q6J("stepControl",s.fg1)("editable",!1),e.xp6(2),e.Q6J("ngIf",s.fg1),e.xp6(1),e.Q6J("stepControl",s.fg2)("editable",!1),e.xp6(2),e.Q6J("ngIf",s.fg2))},directives:[p.PC,d.Vq,d.C0,d.VY,p.O5,r._Y,r.JL,r.sg,r.Fj,r.Q7,r.JJ,r.u,h.wT,h.Vd,C.lW,T.Hw],styles:[""]}),a})()}];let J=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[[p.ez,c.Bz.forChild(G),r.u5,r.UX,v.m,h.a,h.lQ]]}),a})()}}]);