<div appDragDrop class="h-100" (fileDropped)="onFileDropped($event)">

  <!-- Notification -->
  <app-notifications></app-notifications>

  <!-- Content -->
  <div class="container">

    <!-- Detail -->
    <div class="row pb-3 px-0">
      <div class="col-12">
        <div class="row">
          <div class="col-12 sticky-top bg-bifeldy-dark">
            <h2 class="pt-3 border-bottom-dotted">
              <b class="text-bifeldy-dark">Web-SocketRTC Torrent</b>
            </h2>
          </div>
          <div class="col-12">

            <!-- Input Form Filter -->
            <mat-form-field hintLabel="Isi Lalu Tekan 'Enter' Untuk Mencari Torrent ..." class="col-12 col-md-6 col-lg-4 px-3 mb-3" [color]="'accent'">
              <mat-label>Unduh Dari Info Hash / Magnet URI</mat-label>
              <input matInput #input placeholder="Ex. magnet:123qwe...!@#" (keyup.enter)="downloadFiles($event)" [(ngModel)]="magnetHash" [disabled]="isProcessing" />
              <mat-icon matSuffix>cloud_download</mat-icon>
              <mat-progress-bar color="warn" mode="indeterminate" *ngIf="isProcessing"></mat-progress-bar>
            </mat-form-field>

            <!-- Table -->
            <div class="row mx-2">
              <div class="col-12" style="overflow-x: auto;">
                <table mat-table matSort multiTemplateDataRows [dataSource]="dataSource" class="bg-transparent">

                  <!-- Content Row -->
                  <ng-container matColumnDef="{{ tdc }}" *ngFor="let tdc of tableDataColumn">
                    <th mat-header-cell *matHeaderCellDef class="px-3 text-center" mat-sort-header>
                      <h3 class="m-0">
                        <span [style.color]="'#ff4081'" *ngIf="tdc.toUpperCase() == 'NAME'">üîñ NAME</span>
                        <span [style.color]="'#ff4081'" *ngIf="tdc.toUpperCase() == 'LENGTH'">üíæ SIZE</span>
                        <span [style.color]="'#ff4081'" *ngIf="tdc.toUpperCase() == 'DOWNLOADED'">üíø DOWNLOADED</span>
                        <span [style.color]="'#ff4081'" *ngIf="tdc.toUpperCase() == 'UPLOADED'">üìÄ UPLOADED</span>
                        <span [style.color]="'#ff4081'" *ngIf="tdc.toUpperCase() == 'PROGRESS'">üîÑ PROGRESS</span>
                        <span [style.color]="'#ff4081'" *ngIf="tdc.toUpperCase() == 'DOWNLOADSPEED'">üîΩ SPEED</span>
                        <span [style.color]="'#ff4081'" *ngIf="tdc.toUpperCase() == 'UPLOADSPEED'">üîº SPEED</span>
                        <span [style.color]="'#ff4081'" *ngIf="tdc.toUpperCase() == 'TIMEREMAINING'">üïë ~ETA.</span>
                        <span [style.color]="'#ff4081'" *ngIf="tdc.toUpperCase() == 'NUMPEERS'">üß≤ PEERS</span>
                        <span [style.color]="'#ff4081'" *ngIf="tdc.toUpperCase() == 'RATIO'">üåê RATIO</span>
                      </h3>
                    </th>
                    <td mat-cell *matCellDef="let row" class="px-3 text-center" style="cursor: pointer;">
                      <h3 class="m-0 {{ tdc.toUpperCase() == 'NAME' ? 'text-start' : '' }}">
                        <span *ngIf="tdc.toUpperCase() == 'NAME'">{{ row[tdc] }}</span>
                        <span *ngIf="tdc.toUpperCase() == 'LENGTH'">{{ row[tdc] | bytes }}</span>
                        <span *ngIf="tdc.toUpperCase() == 'DOWNLOADED'">{{ row[tdc] | bytes }}</span>
                        <span *ngIf="tdc.toUpperCase() == 'UPLOADED'">{{ row[tdc] | bytes }}</span>
                        <span *ngIf="tdc.toUpperCase() == 'PROGRESS'">{{ row['downloaded'] / row['length'] * 100 | number:'1.2-2' }} %</span>
                        <span *ngIf="tdc.toUpperCase() == 'DOWNLOADSPEED'">{{ row[tdc] | bytes }}/s</span>
                        <span *ngIf="tdc.toUpperCase() == 'UPLOADSPEED'">{{ row[tdc] | bytes }}/s</span>
                        <span *ngIf="tdc.toUpperCase() == 'TIMEREMAINING'">{{ row[tdc] <= 0 ? 'COMPLETED' : (row[tdc] / 1000 | number:'1.0-0') + ' s' }}</span>
                        <span *ngIf="tdc.toUpperCase() == 'NUMPEERS'">{{ row[tdc] }}</span>
                        <span *ngIf="tdc.toUpperCase() == 'RATIO'">{{ row[tdc] | number:'1.4-4' }}</span>
                      </h3>
                    </td>
                  </ng-container>

                  <!-- Expanded Content Row -->
                  <ng-container matColumnDef="expandedDetail">
                    <td mat-cell *matCellDef="let row" [attr.colspan]="tableDataColumn.length">
                      <div class="element-detail" [@detailExpand]="row == torrent.expandedRow ? 'expanded' : 'collapsed'">
                        <div class="py-3 row">
                          <div class="col-2">
                            <!-- 
                              <div class="py-3 text-center">
                                // TODO :: Peers Graph
                                <br />
                                // TODO :: Pause & Resume
                              </div>
                            -->
                            <button class="w-100" mat-stroked-button color="accent" (click)="removeTorrent(row.infoHash)">
                              <mat-icon class="me-1">delete_outline</mat-icon>
                              Delete / Remove Torrent
                            </button>
                          </div>
                          <div class="col-4">
                            <p class="px-2 text-truncate" *ngIf="row.infoHash">
                              Info Hash ::
                              <span class="text-success">
                                {{ row.infoHash }}
                              </span>
                            </p>
                            <p class="px-2 text-truncate" *ngIf="row.magnetURI">
                              Magnet URI ::
                              <a class="text-primary text-decoration-none" [href]="row.magnetURI | safeUrl">
                                {{ row.magnetURI }}
                              </a>
                            </p>
                            <p class="px-2 text-truncate" *ngIf="row.maxWebConns">
                              Max. Peers Web Connections ::
                              <span class="text-success">
                                {{ row.maxWebConns }}
                              </span>
                            </p>
                            <p class="px-2 text-truncate" *ngIf="row.comment">
                              Comment ::
                              <span class="text-success">
                                {{ row.comment }}
                              </span>
                            </p>
                            <p class="px-2 text-truncate" *ngIf="row.created">
                              Created On ::
                              <span class="text-success">
                                {{ row.created }}
                              </span>
                            </p>
                            <p class="px-2 text-truncate" *ngIf="row.createdBy">
                              Created By ::
                              <span class="text-success">
                                {{ row.createdBy }}
                              </span>
                            </p>
                            <div class="px-2 text-truncate">
                              Announce Trackers ::
                              <ul class="text-success m-0">
                                <li *ngFor="let a of row.announce">
                                  {{ a }}
                                </li>
                              </ul>
                            </div>
                          </div>
                          <div class="col-6">
                            <div class="px-2">
                              Content Files ‚ú® Klik Untuk Download ::
                              <ul class="m-0">
                                <li *ngFor="let f of row.files">
                                  <div (click)="saveFile(f)" style="cursor: pointer;">
                                    <span class="text-{{ f.downloaded / f.length >= 1 ? 'primary' : 'bifeldy-dark' }}">
                                      {{ f.name }}
                                    </span>
                                    --
                                    <span class="text-warning">
                                      {{ f.downloaded / f.length * 100 | number:'1.2-2' }} %
                                    </span>
                                    ::
                                    <span class="text-success">
                                      {{ f.downloaded | bytes }} / {{ f.length | bytes }}
                                    </span>
                                  </div>
                                </li>
                              </ul>
                            </div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="tableDataColumn"></tr>
                  <tr mat-row *matRowDef="let row; columns: tableDataColumn;"
                    class="element-row" [class.expanded-row]="torrent.expandedRow === row"
                    (click)="toggleExpanded(row)"></tr>
                  <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
                  <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell text-center align-items-center p-0" [attr.colspan]="tableDataColumn.length"
                      style="background-image: url('/assets/img/404-no-data.png'); background-size: contain; background-position: center; background-repeat: no-repeat; height: 256px;">
                      <div class="row align-items-center h-100">
                        <div class="col-8 mx-auto text-light text-center rounded py-3" style="background-color: rgba(0, 0, 0, 0.5);">
                          <h3 class="m-0">
                            Tidak Ada Data ¬Ø\_(„ÉÑ)_/¬Ø
                          </h3>
                        </div>
                      </div>
                    </td>
                  </tr>
                </table>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>
  
  <input type="file" #fileDropRef id="fileDropRef" multiple
  (change)="fileBrowseHandler($event.target.files)" [disabled]="isProcessing" style="visibility: hidden;" />
  
  <button (click)="fileDropRef.click()" mat-fab color="warn" class="me-3 mb-5 fab-button" matTooltip="Seed Berkas"
  style="position: fixed; bottom: 0; right: 0;" [disabled]="isProcessing">
  <mat-icon>cloud_upload</mat-icon>
  </button>

</div>
